<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VR Box - Cubo con Bot√≥n C (25)</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #debug {
      position: fixed;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0,0,0,0.8);
      padding: 12px;
      border-radius: 10px;
      font-size: 16px;
      z-index: 1000;
      font-family: monospace;
      font-weight: bold;
    }
    .a-enter-vr-button {
      background: linear-gradient(45deg, #2E7D32, #4CAF50) !important;
      border-radius: 15px !important;
      padding: 18px 35px !important;
      font-size: 20px !important;
      box-shadow: 0 8px 16px rgba(0,0,0,0.4) !important;
    }
  </style>
</head>
<body>

  <div id="debug">
    üîå Conecta mando VR Box<br>
    üéÆ Bot√≥n C (25): Agarrar/Soltar<br>
    üïπÔ∏è Joystick: Mover
  </div>

  <!-- ESCENA A-FRAME -->
  <a-scene 
    embedded
    vr-mode-ui="enabled: true"
    device-orientation-permission-ui="enabled: false"
    background="color: #87CEEB"
  >

    <!-- C√°mara -->
    <a-camera id="camera" position="0 1.6 0"></a-camera>

    <!-- Cubo GRANDE y visible -->
    <a-box 
      id="cubo"
      position="0 1 -2.5"
      width="0.6" height="0.6" depth="0.6"
      color="#FF5722"
      shadow
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
    ></a-box>

    <!-- Suelo -->
    <a-plane 
      position="0 0 -4" 
      rotation="-90 0 0" 
      width="12" height="12" 
      color="#43A047"
      shadow
    ></a-plane>

    <!-- Luces -->
    <a-light type="ambient" intensity="0.7"></a-light>
    <a-light type="directional" position="5 10 5" intensity="0.9"></a-light>

  </a-scene>

  <!-- SCRIPT: BOT√ìN 25 + JOYSTICK -->
  <script>
    const scene = document.querySelector('a-scene');
    const debug = document.getElementById('debug');
    const cubo = document.getElementById('cubo');
    const camera = document.getElementById('camera');

    let isGrabbing = false;
    let gamepad = null;

    // Debug en tiempo real
    function updateDebug() {
      const gps = navigator.getGamepads();
      for (let gp of gps) {
        if (gp && gp.connected) {
          gamepad = gp;
          const btn25 = gp.buttons[25]?.pressed ? 'üî¥ PRESIONADO' : '‚ö™';
          const axisX = (gp.axes[0] || 0).toFixed(1);
          const axisY = (gp.axes[1] || 0).toFixed(1);
          const status = isGrabbing ? 'üü† AGARRADO' : 'üî¥ LIBRE';
          
          debug.innerHTML = `
            ‚úÖ MANDO CONECTADO<br>
            ${btn25} Bot√≥n C (25)<br>
            üïπÔ∏è X:${axisX} Y:${axisY}<br>
            ${status} Cubo
          `;
          return;
        }
      }
      debug.innerHTML = '‚ùå Conecta mando Bluetooth';
    }

    // Escanear cada 100ms
    setInterval(updateDebug, 100);

    // BOT√ìN 25: Agarrar/Soltar
    window.addEventListener('gamepadbuttondown', (e) => {
      if (e.buttonIndex === 25) {
        console.log('üéÆ Bot√≥n C (25) PRESIONADO');
        
        if (!isGrabbing) {
          // Verificar distancia (m√°x 4m)
          const camPos = camera.getAttribute('position');
          const cubePos = cubo.getAttribute('position');
          const dist = camPos.distanceTo(cubePos);
          
          if (dist < 4) {
            isGrabbing = true;
            cubo.setAttribute('material', 'color', '#FF9800');  // Naranja
            cubo.setAttribute('animation', 'property: scale; to: 1.2 1.2 1.2; dur: 200; loop: false');
            console.log('‚úÖ CUBO AGARRADO!');
          } else {
            console.log('‚ùå Cubo muy lejos:', dist.toFixed(1) + 'm');
          }
        }
      }
    });

    window.addEventListener('gamepadbuttonup', (e) => {
      if (e.buttonIndex === 25 && isGrabbing) {
        isGrabbing = false;
        cubo.setAttribute('material', 'color', '#FF5722');  // Rojo
        cubo.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 200; loop: false');
        console.log('‚úÖ CUBO SOLTADO!');
      }
    });

    // MOVIMIENTO CON JOYSTICK (axes 0 y 1)
    AFRAME.registerComponent('joystick-mover', {
      tick: function () {
        if (!gamepad || !isGrabbing) return;

        const axisX = gamepad.axes[0] || 0;
        const axisY = gamepad.axes[1] || 0;

        // Deadzone 0.15
        if (Math.abs(axisX) < 0.15 && Math.abs(axisY) < 0.15) return;

        const speed = 5.0;  // R√°pido
        const delta = this.el.sceneEl.delta / 1000;

        const pos = cubo.getAttribute('position');
        cubo.setAttribute('position', {
          x: pos.x + axisX * speed * delta,
          y: pos.y,
          z: pos.z - axisY * speed * delta  // Invertido: joystick arriba = cubo hacia adelante
        });
      }
    });

    cubo.setAttribute('joystick-mover', {});

    // Rotaci√≥n suave del cubo cuando NO est√° agarrado
    cubo.setAttribute('animation__rotate', {
      property: 'rotation',
      to: '0 360 0',
      loop: true,
      dur: 10000,
      easing: 'linear'
    });

    console.log('üöÄ VR Box Listo! Bot√≥n C=25 + Joystick');
  </script>

</body>
</html>
